version: "3.3"
services:
#   postgres:
#     image: postgres:15
#     container_name: postgres
#     volumes:
#       - ~/.pg/pg_data/star-burger:/var/lib/postgresql/data
#     env_file:
#       -.env

  frontend:
    build:
      dockerfile: Dockerfile.frontend
      context: .
    container_name: frontend
    volumes:
      - /opt/star-burger/staticfiles/:/star-burger/staticfiles/
    ports:
      - 1234:1234
    command: >
      bash -c "./node_modules/.bin/parcel build bundles-src/index.js --dist-dir bundles --public-url="./""

  backend:
    build:
      dockerfile: Dockerfile.backend
      context: .
    container_name: backend
    volumes:
      - /opt/star-burger/staticfiles/:/star-burger/staticfiles/
      - /opt/star-burger/media/:/star-burger/media/
    ports:
      - 8081:8081
    env_file:
      - .env
    depends_on:
      - frontend
    command: >
      bash -c "gunicorn -w 5 -b 0.0.0.0:8081 star_burger.wsgi:application"

